{% extends 'base.html' %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='lib/bootstrap-table.min.css') }}">

{{super()}}
{% endblock %}

{% block content %}

<div class="container">
    <table id="table">
        <thead>
          <tr>
            <th data-field="device_no" data-sortable="true">Device no.</th>
            <th data-field="device_uuid" data-sortable="true">Device uuid</th>
            <th data-field="device_name" data-sortable="true">Device name</th>
<!--            <th data-field="ip" data-sortable="true">IP address</th>-->
            <th data-field="status" data-sortable="true">Status</th>
            <th data-field="last_photo" data-sortable="true">Last photo</th>
<!--            <th data-field="actions" data-formatter="actionFormatter" data-events="operateEvents">actions</th>-->
          </tr>
        </thead>
      </table>
<!--</div>-->
<!--<form id="broadcast" method="POST" action='#'>-->
<!--    <input type="text" name="broadcast_data" id="broadcast_data" placeholder="Message">-->
<!--    <input type="submit" value="Broadcast">-->
<!--</form>-->
<!--<h2>Receive:</h2>-->
<!--<div id="log"></div>-->

    <div class="container">
        <div class="images">
            <img id="streamed-image" src="">
        </div>
        <div class="contents">
            <button id='play-btn'>PLAY</button>
        </div>
    </div>

{% endblock %}

{% block scripts %}
{{super()}}
<script type="text/javascript" src="{{ url_for('static', filename='lib/bootstrap-table.min.js') }}" charset="utf-8"></script>
<script type="text/javascript" src="{{ url_for('static', filename='lib/socket.io.min.js') }}" charset="utf-8"></script>
<script>
    function loadTable()
    {
        $(function () {
          $('#table').bootstrapTable({
          });
        });
    }
    function fetchdevices(){
        $.getJSON(
            "_cameras",
            function(data){
                $('#table').bootstrapTable("load",
                data
                );
            }
        );
    }
    loadTable();
    setInterval(fetchdevices, 1000);
</script>
<script>
$(document).ready(function(){
    var url = 'http://' + document.domain + ':' + location.port + '/test'
    console.log(url)
    var socket = io.connect(url);
    socket.on('my response', function(msg) {
        $('#log').append('<p>Received: ' + msg.data + '</p>');
    });
    socket.on('stream_response', (msg) => {
            document.querySelector('#streamed-image').src = msg.image;
        });

    $('form#emit').submit(function(event) {
        socket.emit('my event', {data: $('#emit_data').val()});
        return false;
    });
    $('form#broadcast').submit(function(event) {
        socket.emit('my broadcast event', {data: $('#broadcast_data').val()});
        return false;
    });
});
</script>
{% endblock %}